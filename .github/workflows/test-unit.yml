name: ðŸ§ª Unit Tests

on:
  push:
    branches: main
  pull_request:
    branches: main
  schedule:
    - cron: '0 3 * * *'  # Run daily at 05:00 AM UTC+2
  workflow_dispatch:

jobs:
  test-unit:
    name: ðŸ§ª Run unit tests
    runs-on: tenki-standard-autoscale

    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v5

      - name: ðŸž Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: ðŸ§° Install dependencies
        run: bun install

      - name: ðŸ§ª Run unit tests with coverage
        run: bun run test:unit
        working-directory: apps/web

      - name: ðŸ“Š Upload coverage reports
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: unit-coverage
          path: apps/web/coverage/
          retention-days: 7

      - name: ðŸ“ˆ Coverage summary
        if: always()
        run: |
          echo "## âœ… Unit Test Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Coverage Report" >> $GITHUB_STEP_SUMMARY
          echo "Coverage reports available in artifacts: \`unit-coverage\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "View HTML report: Download \`unit-coverage\` artifact and open \`index.html\`" >> $GITHUB_STEP_SUMMARY

